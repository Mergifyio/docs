---
import type { CollectionEntry } from 'astro:content';
import type { MarkdownHeading } from 'astro';
import generateToc from '~/util/generateToc';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import CopyForLLMButton from '../components/CopyForLLMButton.astro';
import PageContent from '../components/PageContent/PageContent.astro';
import RightSidebar from '../components/RightSidebar/RightSidebar.astro';
import TableOfContents from '../components/RightSidebar/TableOfContents';
import ViewMarkdownButton from '../components/ViewMarkdownButton.astro';
import BaseLayout from './BaseLayout.astro';

export interface Props {
  content: CollectionEntry<'docs'>['data'];
  headings?: MarkdownHeading[];
  breadcrumbTitle?: string;
}

const { content, headings, breadcrumbTitle } = Astro.props;
---

<BaseLayout {...Astro.props}>
	<RightSidebar slot="secondary-sidebar" {...{ content, headings }} />
	<PageContent {...{ content }}>
		{
			Astro.url.pathname !== '/' && (
				<Fragment slot="before-title">
					<div class="page-heading-bar">
						<div class="page-heading-bar__breadcrumbs">
							<Breadcrumbs breadcrumbTitle={breadcrumbTitle} />
						</div>
						<div class="docs-toolbar-actions docs-toolbar-actions--heading">
							<CopyForLLMButton size="compact" />
							<ViewMarkdownButton size="compact" />
						</div>
					</div>
				</Fragment>
			)
		}
		<Fragment slot="before-article">
			{
				headings && (
					<nav>
						<TableOfContents
							client:media="(max-width: 82em)"
							toc={generateToc(headings)}
							labels={{
								onThisPage: 'On this page',
							}}
							isMobile={true}
						/>
					</nav>
				)
			}
		</Fragment>
		<Fragment slot="after-title"><slot name="header" /></Fragment>
		<slot />
	</PageContent>
</BaseLayout>
